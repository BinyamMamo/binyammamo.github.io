<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Determinants Study Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            padding: 2rem 1rem;
            overflow-y: auto;
            transition: transform 0.3s ease;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .sidebar h2 {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 600;
        }

        .chapter-nav {
            margin-bottom: 2rem;
        }

        .chapter-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .chapter-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .chapter-item.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-color: #4facfe;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        }

        .chapter-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .chapter-progress {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 4px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .progress-fill {
            background: rgba(255, 255, 255, 0.8);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            color: white;
            text-align: center;
        }

        .stats h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 320px;
            padding: 2rem;
            max-width: 900px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .chapter-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
        }

        .chapter-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .chapter-header {
            border-bottom: 3px solid #4facfe;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .chapter-number {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .chapter-title-main {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .chapter-description {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 4px solid #4facfe;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .question-number {
            background: #4facfe;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .options {
            margin-bottom: 1.5rem;
        }

        .option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .option:hover {
            background: #e3f2fd;
            border-color: #4facfe;
            transform: translateX(5px);
        }

        .option.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-color: #4facfe;
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .option.correct {
            background: linear-gradient(135deg, #2ed573 0%, #17c0eb 100%);
            border-color: #2ed573;
            color: white;
            box-shadow: 0 4px 15px rgba(46, 213, 115, 0.3);
        }

        .option.incorrect {
            background: linear-gradient(135deg, #ff7675 0%, #fd79a8 100%);
            border-color: #ff7675;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 118, 117, 0.3);
        }

        .option-letter {
            background: #dee2e6;
            color: #495057;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option.selected .option-letter,
        .option.correct .option-letter,
        .option.incorrect .option-letter {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .option-status {
            margin-left: auto;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .explanation {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #4facfe;
            padding: 1.5rem;
            border-radius: 0 12px 12px 0;
            margin-top: 1rem;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .explanation h4 {
            color: #2c3e50;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .explanation h4::before {
            content: "💡";
            margin-right: 0.5rem;
        }

        .explanation p {
            color: #666;
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .show-answer-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .show-answer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .chapter-title-main {
                font-size: 1.5rem;
            }

            .question-text {
                font-size: 1.1rem;
            }

            .question-card {
                padding: 1.5rem;
            }
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 12px;
            padding: 0.8rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        @media (max-width: 768px) {
            .overlay.show {
                display: block;
            }
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: white;
            font-size: 1.2rem;
        }

        .error {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem;
            text-align: center;
            color: #e74c3c;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            z-index: 1000;
        }

        .back-to-top.show {
            opacity: 1;
            transform: translateY(0);
        }

        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .chapter-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <button class="menu-toggle" onclick="toggleSidebar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>
    
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    
    <div class="container">
        <div class="sidebar" id="sidebar">
            <h2>📚 Study Guide</h2>
            
            <div class="chapter-nav" id="chapterNav">
                <div class="loading">Loading chapters...</div>
            </div>
            
            <div class="stats" id="overallStats">
                <h3>Overall Progress</h3>
                <div class="stat-item">
                    <span>Total Questions:</span>
                    <span id="totalQuestions">0</span>
                </div>
                <div class="stat-item">
                    <span>Answered:</span>
                    <span id="totalAnswered">0</span>
                </div>
                <div class="stat-item">
                    <span>Correct:</span>
                    <span id="totalCorrect">0</span>
                </div>
                <div class="stat-item">
                    <span>Accuracy:</span>
                    <span id="overallAccuracy">0%</span>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1>🏥 Health Determinants Study Guide</h1>
                <p>Comprehensive questions organized by chapter with detailed explanations. Click on options to see immediate feedback and learn as you go!</p>
            </div>
            
            <div id="chaptersContainer">
                <div class="loading">Loading study content...</div>
            </div>
        </div>
    </div>
    
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">↑</button>

    <script>
        let chaptersData = [];
        let userAnswers = {};
        let currentActiveChapter = null;

        // Embedded chapters data
        const studyData = {
            "chapters": [
                {
                    "id": 1,
                    "title": "Self, Family, and Community / Public Health & Societal Factors",
                    "description": "Understanding how individual, social, and environmental factors interact to influence health outcomes.",
                    "questions": [
                        {
                            "id": 1,
                            "question": "According to the socioecological model, which of the following best explains why a highly educated individual might still engage in unhealthy behaviors?",
                            "options": [
                                "Education always ensures healthy behavior",
                                "Environmental and social influences can override individual knowledge",
                                "Genetics completely determines behavior",
                                "Employment status has no influence on behavior"
                            ],
                            "correct": 1,
                            "explanation": "The socioecological model identifies complex levels and interrelationships that influence health. Even highly educated individuals may struggle with healthy behaviors due to environmental factors (lack of green space, unsafe neighborhoods) and social influences (peer pressure, community norms) that can override individual knowledge."
                        },
                        {
                            "id": 2,
                            "question": "Which health model suggests that a person's perception of disease severity influences their behavior change?",
                            "options": [
                                "Socioecological Model",
                                "Health Belief Model",
                                "Transtheoretical Model",
                                "Behaviorism Theory"
                            ],
                            "correct": 1,
                            "explanation": "The Health Belief Model explains how health behaviors are influenced by four key perceptions: perceived susceptibility, perceived seriousness of consequences (disease severity), perceived benefits of action, and perceived barriers."
                        },
                        {
                            "id": 3,
                            "question": "A woman avoids public parks due to safety concerns in her neighborhood, reducing her physical activity. Which determinant is most at play?",
                            "options": [
                                "Genetic",
                                "Individual knowledge",
                                "Environmental",
                                "Cultural"
                            ],
                            "correct": 2,
                            "explanation": "This reflects environmental determinants - specifically the built environment. Safety concerns in public parks represent a geographical barrier that prevents physical activity, even when individuals understand the benefits of exercise."
                        },
                        {
                            "id": 4,
                            "question": "Despite knowing the dangers, a teenager smokes to fit in with friends. This scenario best reflects the influence of:",
                            "options": [
                                "Media",
                                "Peers",
                                "Religion",
                                "Genetics"
                            ],
                            "correct": 1,
                            "explanation": "This demonstrates the powerful impact of peer influence on health behaviors. Even when individuals know the risks, social pressure from peers can override individual knowledge, as the desire to fit in becomes a stronger motivator."
                        },
                        {
                            "id": 6,
                            "question": "In the Stages of Change Model, which stage does someone say, 'Maybe I should think about quitting smoking'?",
                            "options": [
                                "Precontemplation",
                                "Contemplation",
                                "Preparation",
                                "Maintenance"
                            ],
                            "correct": 1,
                            "explanation": "The Contemplation stage is characterized by individuals considering making a change, often thinking 'Well... maybe'. This involves acknowledging the possibility of change without yet committing to specific steps."
                        }
                    ]
                },
                {
                    "id": 2,
                    "title": "Genetics",
                    "description": "Exploring heredity, genetic disorders, and how genes interact with environmental factors.",
                    "questions": [
                        {
                            "id": 5,
                            "question": "Which of the following is an example of epigenetics?",
                            "options": [
                                "A person inheriting blue eyes",
                                "Air pollution triggering gene changes passed to offspring",
                                "A dominant gene for height",
                                "A family history of heart disease"
                            ],
                            "correct": 1,
                            "explanation": "Epigenetics refers to chemical modifications that alter DNA without changing the sequence. Environmental factors like air pollution can cause epigenetic changes that are passed to offspring."
                        },
                        {
                            "id": 21,
                            "question": "A woman with type A blood (genotype AO) claims a man with type AB blood fathered her child, who has type B blood. Which statement is correct?",
                            "options": [
                                "This is genetically impossible",
                                "The child must be adopted",
                                "The claim is possible only if the mother is AO",
                                "The mother must have genotype AA"
                            ],
                            "correct": 2,
                            "explanation": "For a child with type B blood (genotype BO), the mother (AO) can pass O and the father (AB) can pass B. This is only possible if the mother is heterozygous (AO)."
                        },
                        {
                            "id": 22,
                            "question": "Two parents with the genotype Bb (black fur is dominant) produce offspring. Which probability is correct?",
                            "options": [
                                "All offspring will have black fur",
                                "25% chance for white fur offspring",
                                "75% of offspring will be white",
                                "All offspring will be heterozygous"
                            ],
                            "correct": 1,
                            "explanation": "Using a Punnett square for Bb × Bb: 25% BB (black), 50% Bb (black), 25% bb (white). Only bb genotype (25%) will have white fur."
                        }
                    ]
                },
                {
                    "id": 3,
                    "title": "Mental Health and Stress",
                    "description": "Understanding stress responses, mental health disorders, and coping mechanisms.",
                    "questions": [
                        {
                            "id": 56,
                            "question": "Which best distinguishes eustress from distress?",
                            "options": [
                                "Eustress is always harmful, while distress is always beneficial",
                                "Eustress is positive stress that promotes growth, while distress is negative and overwhelming",
                                "Both are equally harmful over time",
                                "Eustress occurs only in physical situations, distress in emotional ones"
                            ],
                            "correct": 1,
                            "explanation": "Eustress is positive stress that can be motivating and promote growth (e.g., excitement about college). Distress is negative stress that can be overwhelming and contribute to health problems."
                        },
                        {
                            "id": 57,
                            "question": "Which characteristic would best help an individual cope with a stressful life event by viewing it as a challenge rather than a threat?",
                            "options": [
                                "Pessimism",
                                "Hardiness",
                                "Type D personality",
                                "Low resilience"
                            ],
                            "correct": 1,
                            "explanation": "Hardiness is an effective coping style characterized by viewing stressors as challenges rather than threats. Hardy individuals see stressful situations as manageable challenges."
                        }
                    ]
                },
                {
                    "id": 4,
                    "title": "Body Weight and Body Composition",
                    "description": "Examining BMI, body fat distribution, and their health implications.",
                    "questions": [
                        {
                            "id": 30,
                            "question": "A man's BMI is calculated as 31.2 kg/m². According to international guidelines, he would be classified as:",
                            "options": [
                                "Normal weight",
                                "Overweight",
                                "Obese",
                                "Morbidly obese"
                            ],
                            "correct": 2,
                            "explanation": "BMI classifications: Underweight (<18.5), Normal (18.5-24.9), Overweight (25-29.9), Obese (≥30). A BMI of 31.2 falls in the obese category."
                        },
                        {
                            "id": 31,
                            "question": "A male patient has a waist circumference of 106 cm. What can be inferred about his disease risk?",
                            "options": [
                                "Normal risk",
                                "Increased risk due to visceral fat",
                                "No risk if BMI is normal",
                                "Risk only if cholesterol is also elevated"
                            ],
                            "correct": 1,
                            "explanation": "Large abdominal circumference indicates increased visceral fat, which is metabolically active and represents independent disease risk even if BMI is normal."
                        }
                    ]
                },
                {
                    "id": 5,
                    "title": "Cancer",
                    "description": "Understanding cancer biology, prevention, detection, and treatment approaches.",
                    "questions": [
                        {
                            "id": 47,
                            "question": "Which best explains why stem cells, while vital for tissue repair, pose a higher risk for cancer?",
                            "options": [
                                "They divide slowly and predictably",
                                "They are shielded from mutations",
                                "They can divide indefinitely and may accumulate mutations",
                                "They lack any DNA repair mechanisms"
                            ],
                            "correct": 2,
                            "explanation": "Stem cells can divide indefinitely, and each division carries mutation risk. Their prolonged division capacity increases the chance of accumulating the critical mutations required for cancer."
                        },
                        {
                            "id": 48,
                            "question": "A tumor that grows slowly and does not invade nearby tissues is classified as:",
                            "options": [
                                "Malignant",
                                "Benign",
                                "Metastatic",
                                "Invasive"
                            ],
                            "correct": 1,
                            "explanation": "Benign tumors are characterized by slow growth and being unlikely to spread to surrounding tissues, unlike malignant tumors which can invade and metastasize."
                        }
                    ]
                },
                {
                    "id": 6,
                    "title": "Epidemiology / Public Health Approach",
                    "description": "Learning about disease patterns, causation, and public health investigation methods.",
                    "questions": [
                        {
                            "id": 35,
                            "question": "An outbreak of salmonella occurs at a restaurant in Dubai. The investigation reveals contaminated lettuce as the source. Which epidemiological factor does the lettuce represent?",
                            "options": [
                                "Host",
                                "Agent",
                                "Environment",
                                "Determinant"
                            ],
                            "correct": 2,
                            "explanation": "In the epidemiological triangle: Agent (Salmonella bacteria), Host (people who got sick), Environment (contaminated lettuce as the vehicle of transmission)."
                        },
                        {
                            "id": 37,
                            "question": "A new virus spreads rapidly across several continents. This would be best classified as:",
                            "options": [
                                "Endemic",
                                "Cluster",
                                "Epidemic",
                                "Pandemic"
                            ],
                            "correct": 3,
                            "explanation": "A pandemic is a disease that spreads across regions or continents. A virus spreading rapidly across several continents fits this definition."
                        }
                    ]
                },
                {
                    "id": 7,
                    "title": "Nutrition and Sports Supplements",
                    "description": "Examining nutritional needs, supplement safety, and performance-enhancing substances.",
                    "questions": [
                        {
                            "id": 67,
                            "question": "Which best explains why dietary supplements are not always reliable despite being sold legally?",
                            "options": [
                                "They are pre-approved for safety before sale",
                                "They are completely regulated like prescription drugs",
                                "The FDA monitors them only after they enter the market and only if issues arise",
                                "They must pass extensive human trials before being sold"
                            ],
                            "correct": 2,
                            "explanation": "Dietary supplements are not effectively regulated unless problems arise. The FDA's role begins largely after products enter the marketplace, unlike prescription drugs."
                        },
                        {
                            "id": 68,
                            "question": "Why might a female endurance athlete who avoids dairy products be at higher risk for stress fractures?",
                            "options": [
                                "Low calcium intake can weaken bones and increase fracture risk",
                                "Avoiding dairy reduces hydration levels",
                                "Dairy avoidance always causes muscle cramps",
                                "Dairy contains protein that prevents fractures"
                            ],
                            "correct": 0,
                            "explanation": "Calcium deficiency increases stress fracture risk. Dairy products are a primary calcium source essential for bone health and preventing fractures."
                        }
                    ]
                }
            ]
        };

        function loadChapters() {
            try {
                chaptersData = studyData.chapters;
                if (!chaptersData || chaptersData.length === 0) {
                    showError('No study content found.');
                    return;
                }
                initializeStudyGuide();
            } catch (error) {
                showError('Failed to load study content. Please refresh the page.');
            }
        }

        function showError(message) {
            document.getElementById('chaptersContainer').innerHTML = `
                <div class="error">
                    <h2>❌ Error</h2>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #e74c3c; color: white; border: none; border-radius: 8px; cursor: pointer;">Retry</button>
                </div>
            `;
        }

        function initializeStudyGuide() {
            createChapterNavigation();
            renderAllChapters();
            updateOverallStats();
            setupScrollSpy();
        }

        function createChapterNavigation() {
            const nav = document.getElementById('chapterNav');
            nav.innerHTML = '';
            
            chaptersData.forEach((chapter, index) => {
                const chapterItem = document.createElement('div');
                chapterItem.className = 'chapter-item';
                chapterItem.onclick = () => scrollToChapter(chapter.id);
                
                const answered = getChapterAnsweredCount(chapter.id);
                const total = chapter.questions.length;
                const progress = total > 0 ? (answered / total) * 100 : 0;
                
                chapterItem.innerHTML = `
                    <div class="chapter-title">Chapter ${chapter.id}</div>
                    <div style="font-size: 0.9rem; margin-bottom: 0.5rem;">${chapter.title}</div>
                    <div class="chapter-progress">${answered}/${total} completed</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                nav.appendChild(chapterItem);
            });
        }

        function renderAllChapters() {
            const container = document.getElementById('chaptersContainer');
            container.innerHTML = '';
            
            chaptersData.forEach((chapter, index) => {
                const chapterSection = document.createElement('div');
                chapterSection.className = 'chapter-section';
                chapterSection.id = `chapter-${chapter.id}`;
                
                const answered = getChapterAnsweredCount(chapter.id);
                const correct = getChapterCorrectCount(chapter.id);
                const accuracy = answered > 0 ? Math.round((correct / answered) * 100) : 0;
                
                chapterSection.innerHTML = `
                    <div class="chapter-header">
                        <div class="chapter-number">Chapter ${chapter.id}</div>
                        <h2 class="chapter-title-main">${chapter.title}</h2>
                        <p class="chapter-description">${chapter.description}</p>
                        <div class="chapter-stats">
                            <div class="stat-badge">${chapter.questions.length} Questions</div>
                            <div class="stat-badge">${answered} Answered</div>
                            <div class="stat-badge">${accuracy}% Accuracy</div>
                        </div>
                    </div>
                    
                    <div class="questions-container">
                        ${chapter.questions.map(question => renderQuestion(question, chapter.id)).join('')}
                    </div>
                `;
                
                container.appendChild(chapterSection);
                
                // Animate in with delay
                setTimeout(() => {
                    chapterSection.classList.add('visible');
                }, index * 200);
            });
        }

        function renderQuestion(question, chapterId) {
            const questionKey = `${chapterId}-${question.id}`;
            const userAnswer = userAnswers[questionKey];
            const isAnswered = userAnswer !== undefined;
            
            return `
                <div class="question-card">
                    <div class="question-number">Question ${question.id}</div>
                    <div class="question-text">${question.question}</div>
                    
                    <div class="options">
                        ${question.options.map((option, index) => {
                            let optionClass = 'option';
                            let statusIcon = '';
                            
                            if (isAnswered) {
                                if (index === question.correct) {
                                    optionClass += ' correct';
                                    statusIcon = '✓';
                                } else if (index === userAnswer) {
                                    optionClass += ' incorrect';
                                    statusIcon = '✗';
                                }
                            }
                            
                            return `
                                <div class="${optionClass}" onclick="selectOption('${questionKey}', ${index})">
                                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                                    <div style="flex: 1;">${option}</div>
                                    <div class="option-status">${statusIcon}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="explanation ${isAnswered ? 'show' : ''}" id="explanation-${questionKey}">
                        <h4>Explanation</h4>
                        <p>${question.explanation}</p>
                    </div>
                    
                    ${!isAnswered ? `<button class="show-answer-btn" onclick="showAnswer('${questionKey}')">Show Answer</button>` : ''}
                </div>
            `;
        }

        function selectOption(questionKey, optionIndex) {
            if (userAnswers[questionKey] !== undefined) return; // Already answered
            
            userAnswers[questionKey] = optionIndex;
            
            // Find the question data
            const [chapterId, questionId] = questionKey.split('-').map(Number);
            const chapter = chaptersData.find(c => c.id === chapterId);
            const question = chapter.questions.find(q => q.id === questionId);
            
            // Update the question display
            const questionCard = document.querySelector(`#explanation-${questionKey}`).closest('.question-card');
            const options = questionCard.querySelectorAll('.option');
            const showAnswerBtn = questionCard.querySelector('.show-answer-btn');
            
            options.forEach((option, index) => {
                option.onclick = null; // Disable clicking
                
                if (index === question.correct) {
                    option.className = 'option correct';
                    option.querySelector('.option-status').textContent = '✓';
                } else if (index === optionIndex) {
                    option.className = 'option incorrect';
                    option.querySelector('.option-status').textContent = '✗';
                }
            });
            
            // Show explanation
            document.getElementById(`explanation-${questionKey}`).classList.add('show');
            
            // Hide show answer button
            if (showAnswerBtn) {
                showAnswerBtn.style.display = 'none';
            }
            
            // Update stats
            updateOverallStats();
            updateChapterNavigation();
        }

        function showAnswer(questionKey) {
            // Find the question data
            const [chapterId, questionId] = questionKey.split('-').map(Number);
            const chapter = chaptersData.find(c => c.id === chapterId);
            const question = chapter.questions.find(q => q.id === questionId);
            
            // Mark as "viewed" but not answered correctly
            userAnswers[questionKey] = -1; // Special value for "showed answer"
            
            // Update the question display
            const questionCard = document.querySelector(`#explanation-${questionKey}`).closest('.question-card');
            const options = questionCard.querySelectorAll('.option');
            const showAnswerBtn = questionCard.querySelector('.show-answer-btn');
            
            options.forEach((option, index) => {
                option.onclick = null; // Disable clicking
                
                if (index === question.correct) {
                    option.className = 'option correct';
                    option.querySelector('.option-status').textContent = '✓';
                }
            });
            
            // Show explanation
            document.getElementById(`explanation-${questionKey}`).classList.add('show');
            
            // Hide show answer button
            if (showAnswerBtn) {
                showAnswerBtn.style.display = 'none';
            }
            
            // Update stats
            updateOverallStats();
            updateChapterNavigation();
        }

        function getChapterAnsweredCount(chapterId) {
            return chaptersData.find(c => c.id === chapterId).questions.filter(q => {
                const questionKey = `${chapterId}-${q.id}`;
                return userAnswers[questionKey] !== undefined;
            }).length;
        }

        function getChapterCorrectCount(chapterId) {
            const chapter = chaptersData.find(c => c.id === chapterId);
            return chapter.questions.filter(q => {
                const questionKey = `${chapterId}-${q.id}`;
                return userAnswers[questionKey] === q.correct;
            }).length;
        }

        function updateOverallStats() {
            const totalQuestions = chaptersData.reduce((sum, chapter) => sum + chapter.questions.length, 0);
            const totalAnswered = Object.keys(userAnswers).length;
            const totalCorrect = Object.entries(userAnswers).filter(([key, answer]) => {
                if (answer === -1) return false; // Showed answer, not correct
                const [chapterId, questionId] = key.split('-').map(Number);
                const chapter = chaptersData.find(c => c.id === chapterId);
                const question = chapter.questions.find(q => q.id === questionId);
                return answer === question.correct;
            }).length;
            
            const accuracy = totalAnswered > 0 ? Math.round((totalCorrect / totalAnswered) * 100) : 0;
            
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('totalAnswered').textContent = totalAnswered;
            document.getElementById('totalCorrect').textContent = totalCorrect;
            document.getElementById('overallAccuracy').textContent = `${accuracy}%`;
        }

        function updateChapterNavigation() {
            const chapterItems = document.querySelectorAll('.chapter-item');
            chapterItems.forEach((item, index) => {
                const chapter = chaptersData[index];
                const answered = getChapterAnsweredCount(chapter.id);
                const total = chapter.questions.length;
                const progress = total > 0 ? (answered / total) * 100 : 0;
                
                const progressBar = item.querySelector('.progress-fill');
                const progressText = item.querySelector('.chapter-progress');
                
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${answered}/${total} completed`;
            });
        }

        function scrollToChapter(chapterId) {
            const element = document.getElementById(`chapter-${chapterId}`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }
        }

        function setupScrollSpy() {
            const chapterSections = document.querySelectorAll('.chapter-section');
            const chapterItems = document.querySelectorAll('.chapter-item');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const chapterId = entry.target.id.replace('chapter-', '');
                        
                        // Update active chapter in navigation
                        chapterItems.forEach(item => item.classList.remove('active'));
                        const activeItem = document.querySelector(`.chapter-item:nth-child(${chapterId})`);
                        if (activeItem) {
                            activeItem.classList.add('active');
                        }
                        
                        currentActiveChapter = chapterId;
                    }
                });
            }, {
                threshold: 0.3,
                rootMargin: '-100px 0px -100px 0px'
            });
            
            chapterSections.forEach(section => observer.observe(section));
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Back to top button functionality
        window.addEventListener('scroll', () => {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });

        // Initialize when page loads
        window.onload = loadChapters;
    </script>
</body>
</html>